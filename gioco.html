<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Arena con Livelli</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }

        #gameArea {
            width: 100%;
            height: 100vh;
            background-color: #333;
            position: relative;
            overflow: hidden;
        }

        .player {
            width: 50px;
            height: 50px;
            background-color: blue;
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
        }

        .obstacle {
            width: 50px;
            height: 50px;
            background-color: red;
            position: absolute;
            top: -50px;
        }

        .bullet {
            width: 5px;
            height: 15px;
            background-color: yellow;
            position: absolute;
            bottom: 60px; /* Posizionato sopra il giocatore */
        }

        #score {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 20px;
            color: white;
            font-weight: bold;
        }

        .resistant {
            background-color: green; /* Ostacolo resistente */
        }
    </style>
</head>
<body>

<div id="gameArea">
    <div id="score">Punteggio: 0</div>
    <div class="player" id="player"></div>
</div>

<script>
    let player = document.getElementById('player');
    let gameArea = document.getElementById('gameArea');
    let scoreDisplay = document.getElementById('score');

    let playerX = gameArea.offsetWidth / 2 - player.offsetWidth / 2;
    let playerY = gameArea.offsetHeight - player.offsetHeight - 10;
    let score = 0;
    let level = 1;
    let gameInterval;
    let bulletInterval;
    let obstacleSpeed = 2;
    let bulletSpeed = 5;

    player.style.left = playerX + 'px';
    player.style.bottom = (gameArea.offsetHeight - playerY) + 'px';

    function movePlayer(e) {
        if (e.key === 'ArrowLeft' && playerX > 0) {
            playerX -= 10;
        }
        if (e.key === 'ArrowRight' && playerX < gameArea.offsetWidth - player.offsetWidth) {
            playerX += 10;
        }
        player.style.left = playerX + 'px';
    }

    function spawnObstacle() {
        let obstacle = document.createElement('div');
        obstacle.classList.add('obstacle');
        let randomX = Math.floor(Math.random() * (gameArea.offsetWidth - 50));
        obstacle.style.left = randomX + 'px';

        // A partire dal livello 4, aggiungi un ostacolo più resistente
        if (level >= 4 && Math.random() < 0.2) {
            obstacle.classList.add('resistant');
        }

        gameArea.appendChild(obstacle);
        moveObstacle(obstacle);
    }

    function moveObstacle(obstacle) {
        let obstacleY = 0;
        let obstacleInterval = setInterval(function() {
            obstacleY += obstacleSpeed;
            obstacle.style.top = obstacleY + 'px';

            // Collisione con il giocatore
            let obstacleRect = obstacle.getBoundingClientRect();
            let playerRect = player.getBoundingClientRect();
            if (obstacleRect.bottom >= playerRect.top && 
                obstacleRect.left <= playerRect.right &&
                obstacleRect.right >= playerRect.left) {
                // Fine gioco
                clearInterval(obstacleInterval);
                endGame();
            }

            if (obstacleY > gameArea.offsetHeight) {
                clearInterval(obstacleInterval);
                gameArea.removeChild(obstacle);
                score++;
                scoreDisplay.textContent = 'Punteggio: ' + score;

                // Passaggio al livello successivo
                if (score >= level * 50) {
                    level++;
                    obstacleSpeed += 0.5; // Aumenta la velocità degli ostacoli
                    bulletSpeed += 1; // Aumenta la velocità del proiettile
                    alert('Passato al livello ' + level);
                }
            }
        }, 20);
    }

    function createBullet() {
        let bullet = document.createElement('div');
        bullet.classList.add('bullet');
        bullet.style.left = playerX + player.offsetWidth / 2 - 2.5 + 'px';
        gameArea.appendChild(bullet);
        moveBullet(bullet);
    }

    function moveBullet(bullet) {
        let bulletY = playerY + player.offsetHeight;
        let bulletInterval = setInterval(function() {
            bulletY += bulletSpeed; // Movimento verso l'alto
            bullet.style.top = bulletY + 'px';

            // Fine del proiettile se esce dalla finestra
            if (bulletY >= gameArea.offsetHeight) {
                clearInterval(bulletInterval);
                gameArea.removeChild(bullet);
            }

            // Verifica collisione con ostacoli
            let bulletRect = bullet.getBoundingClientRect();
            let obstacles = document.querySelectorAll('.obstacle');
            obstacles.forEach(obstacle => {
                let obstacleRect = obstacle.getBoundingClientRect();
                if (bulletRect.top <= obstacleRect.bottom &&
                    bulletRect.bottom >= obstacleRect.top &&
                    bulletRect.left <= obstacleRect.right &&
                    bulletRect.right >= obstacleRect.left) {
                    // Colpito un ostacolo
                    clearInterval(bulletInterval);
                    gameArea.removeChild(bullet);

                    // Se è un ostacolo resistente, servono più colpi
                    if (obstacle.classList.contains('resistant')) {
                        obstacle.classList.remove('resistant');
                        obstacle.style.backgroundColor = 'orange'; // Cambio di colore
                        score += 5; // Più punti per gli ostacoli resistenti
                    } else {
                        gameArea.removeChild(obstacle);
                        score += 10; // Aggiungi punti per ogni ostacolo distrutto
                    }

                    scoreDisplay.textContent = 'Punteggio: ' + score;
                }
            });
        }, 20);
    }

    function endGame() {
        clearInterval(gameInterval);
        alert('Game Over! Il tuo punteggio finale è: ' + score);
        location.reload();
    }

    // Funzione per avviare il gioco
    function startGame() {
        document.addEventListener('keydown', function(e) {
            movePlayer(e);
            if (e.key === ' ') {
                createBullet(); // Sparare quando si preme la barra spaziatrice
            }
        });
        gameInterval = setInterval(spawnObstacle, 1000);
    }

    startGame();
</script>

</body>
</html>
